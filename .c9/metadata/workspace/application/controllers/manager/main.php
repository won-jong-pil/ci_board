{"changed":true,"filter":false,"title":"main.php","tooltip":"/application/controllers/manager/main.php","value":"<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');\n/**\n * @title 관리자 페이지\n * @author - 원종필(won0334@chol.com)\n * */\nclass Main extends CI_Controller \n{\n\tvar $view_data = array();//view 출력용 데이터\n\n\tfunction __construct()\n\t{\n\t\tparent::__construct();\n\n\t\t$this->view_data['index_file_name'] = 'admin/index';\n\t\t$this->view_data['default_head_file_name'] = 'admin/default_head';\n\t\t$this->view_data['left_file_name'] = 'admin/left';\n\t}\n\t/**\n\t * @title 관리자 로그인폼\n\t * @author - 원종필(won0334@chol.com)\n\t * */\t\n\tfunction login_form()\n\t{\n\t\t//레이아웃 처리(출력)\n\t\t$this->view_data['head_file_name'] = 'admin/login_form_head';\n\t\t$this->load->view('admin/login_form', $this->view_data);\n\t}\n\t/**\n\t * @title 관리자 로그인 처리\n\t * @author - 원종필(won0334@chol.com)\n\t * */\t\n\tfunction log_in()\n\t{\n\t\t$this->load->library('form_validation');\n\t\t$this->form_validation->set_rules('id', '아이디', 'required|min_length[4]|max_length[20]');\n\t\t$this->form_validation->set_rules('passwd', '패스워드', 'required|min_length[8]');\n\t\n\t\tif ($this->form_validation->run() === FALSE)\n\t\t{\n\t\t\talert('입력정보가 올바르지 않습니다.', '/manager/main/login_form', TRUE);\n\t\t}\n\t\n\t\t$id = $this->input->post(\"id\");\n\t\t$passwd = $this->input->post(\"passwd\");\n\t\n\t\t$this->db->from('manager');\n\t\t$this->db->where('id', $id);\n\t\t$result = $this->db->get();\n\t\n\t\tif( $result->num_rows() <= 0 )\n\t\t{\n\t\t\talert('관리자 정보가 올바르지 않습니다.', '/manager/main/login_form', TRUE);\n\t\t}\n\t\telse \n\t\t{\n\t\t\t$mem = $result->row_array();\n\t\t\t$input_pass = hash('sha256', $passwd);\n\n\t\t\tif($mem['attempts'] >= 5)\n\t\t\t{\n\t\t\t\talert('회원 계정이 잠금처리 되었습니다. 관리자에게 문의 하세요.','/manager/main/login_form', TRUE);\n\t\t\t}\n\t\t\t\n\t\t\tif($mem['passwd'] != $input_pass)\n\t\t\t{\n\t\t\t\t$this->db->where('id', $id);\n\t\t\t\t$this->db->set('attempts', 'attempts+1', FALSE);\n\t\t\t\t$this->db->update('manager');\n\t\t\t\talert('회원정보가 올바르지 않습니다.','/manager/main/login_form', TRUE);\n\t\t\t}\n\t\t\t\n\t\t\t$this->db->set('attempts', 0);\n\t\t\t$this->db->where('id', $id);\n\t\t\t$this->db->update('manager');\t\t\t\n\n\t\t\t$this->session->set_userdata('admin_idx', $mem['idx']);\n\t\t\t$this->session->set_userdata('admin_id', $mem['id']);\n\t\t\t$this->session->set_userdata('pass_update_date', $mem['pass_update_date']);\n\t\t\t$this->session->set_userdata('name', urlencode($mem['name']));\n\t\t\t$this->session->set_userdata('level', 99);\n\n\t\t\tif(date('Y-m-d') > date('Y-m-d', strtotime('+90 days', strtotime($this->session->userdata('pass_update_date')))))\n\t\t\t{\n\t\t\t\talert('패스워드를 변경한지 90일이 지났습니다. 패스워드를 변경해 주세요.', '/manager/board/update_form/brd/manager/idx/'.$mem['idx'], TRUE);\n\t\t\t}\t\t\t\n\t\t}\n\n\t\t$this->load->helper('url');\n\t\tredirect('/manager/board/listing/brd/popup');\n\t}\n\t/**\n\t * @title 관리자 로그아웃 처리\n\t * @author - 원종필(won0334@chol.com)\n\t * */\t\n\tfunction log_out()\n\t{\n\t\t$this->session->sess_destroy();\n\t\t$this->load->helper('url');\n\t\tredirect('/manager');\n\t}\n\t/**\n\t * @title 관리자 등록시 id 체크\n\t * @author - 원종필(won0334@chol.com)\n\t * */\n\tfunction id_check()\n\t{\n\t\t$id = $this->input->post('id');\n\t\t\n\t\t$this->db->from('manager');\n\t\t$this->db->where('id', $id);\n\t\t$result = $this->db->get();\n\t\t\n\t\tif( $result->num_rows() <= 0 )\n\t\t{\n\t\t\tif(preg_match(\"/^[0-9A-Z][0-9A-Z_-]{4,20}[0-9A-Z]$/i\", $id))\n\t\t\t{\n\t\t\t\techo 'true';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\techo 'false';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\techo 'false';\n\t\t}\t\t\n\t}\n}\n/*관리자 페이지*/","undoManager":{"mark":-1,"position":29,"stack":[[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":15},"action":"remove","lines":[" * @history"," * @return NULL"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":0},"end":{"row":22,"column":16},"action":"remove","lines":["\t * @history","\t * @return NULL"]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":0},"end":{"row":22,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":0},"end":{"row":32,"column":16},"action":"remove","lines":["\t * @history","\t * @return NULL"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":0},"end":{"row":32,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":26},"end":{"row":7,"column":27},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":27},"end":{"row":7,"column":28},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":28},"end":{"row":7,"column":29},"action":"insert","lines":["퍋"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":28},"end":{"row":7,"column":29},"action":"remove","lines":["퍋"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":28},"end":{"row":7,"column":29},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":29},"end":{"row":7,"column":30},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":30},"end":{"row":7,"column":31},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":31},"end":{"row":7,"column":32},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":32},"end":{"row":7,"column":33},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":32},"end":{"row":7,"column":33},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":32},"end":{"row":7,"column":33},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":33},"end":{"row":7,"column":34},"action":"insert","lines":["출"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":34},"end":{"row":7,"column":35},"action":"insert","lines":["력"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":35},"end":{"row":7,"column":36},"action":"insert","lines":["용"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":36},"end":{"row":7,"column":37},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":37},"end":{"row":7,"column":38},"action":"insert","lines":["데"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":38},"end":{"row":7,"column":39},"action":"insert","lines":["이"]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":39},"end":{"row":7,"column":40},"action":"insert","lines":["터"]}]}],[{"group":"doc","deltas":[{"start":{"row":94,"column":0},"end":{"row":95,"column":16},"action":"remove","lines":["\t * @history","\t * @return NULL"]}]}],[{"group":"doc","deltas":[{"start":{"row":94,"column":0},"end":{"row":95,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":0},"end":{"row":105,"column":16},"action":"remove","lines":["\t * @history","\t * @return NULL"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":0},"end":{"row":105,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":16,"column":43},"action":"remove","lines":["\t\t$url_array = $this->uri->uri_to_assoc(4);"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":17,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":360,"scrollleft":0,"selection":{"start":{"row":36,"column":1},"end":{"row":36,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":21,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1430270450645}